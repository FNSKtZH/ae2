# see: https://caddyserver.com/v1/docs/proxy
# or v2: https://caddyserver.com/docs/caddyfile/concepts
# TODO: add www. variants

{
  email alex.barbalex@gmail.com
  #acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
}

# this results in 502
direktbegruenung.ch/graphql* {
  reverse_proxy * localhost:5000
}

# this results in 502
direktbegruenung.ch/graphiql* {
  reverse_proxy * localhost:5000
}

# this results in 502
direktbegruenung.ch/artendb* {
  reverse_proxy * localhost:4000
}

# this results in 502
direktbegruenung.ch/evab* {
  reverse_proxy * localhost:4000
}

# this results in 502
direktbegruenung.ch/alt* {
  reverse_proxy * localhost:4000
}

direktbegruenung.ch {
  # try proxying these - they should not be cross-domain
  #reverse_proxy /graphql* localhost:5000
  #reverse_proxy /graphiql* localhost:5000
  #reverse_proxy /artendb/* localhost:4000
  #reverse_proxy /evab* localhost:4000
  #reverse_proxy /alt* localhost:4000
  root * /html
  file_server
}

# original goal - but never worked
#api.direktbegruenung.ch {
#  reverse_proxy /graphql* {
#    to localhost:5000
#    header_down Access-Control-Allow-Origin *
#  }
#  reverse_proxy /graphiql* {
#    to localhost:5000
#    header_down Access-Control-Allow-Origin *
#  }
#  reverse_proxy /artendb/* {
#    to localhost:4000
#    header_down Access-Control-Allow-Origin *
#  }
#  reverse_proxy /evab* {
#    to localhost:4000
#    header_down Access-Control-Allow-Origin *
#  }
#  reverse_proxy /alt* {
#    to localhost:4000
#    header_down Access-Control-Allow-Origin *
#  }
#}

# should work with:
# https.graphql.direktbegruenung.ch/graphql
# and
# https.graphql.direktbegruenung.ch/graphiql
#graphql.direktbegruenung.ch {
#  reverse_proxy * localhost:5000 {
#    header_down Access-Control-Allow-Origin *
#  }
#}

# should work with:
# https.json.direktbegruenung.ch/alt
# and
# https.json.direktbegruenung.ch/evab
#json.direktbegruenung.ch {
#  reverse_proxy * localhost:4000 {
#    header_down Access-Control-Allow-Origin *
#  }
#}
